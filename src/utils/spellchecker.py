from spellchecker import SpellChecker
from typing import Set

CUSTOM_WORDS = {
    "в", "во", "на", "по", "с", "со", "и", "или", "к", "ко",
    "за", "из", "от", "до",

    "Минск", "Минска", "Минску", "Минском", "Минске",
    "Брест", "Бреста", "Бресту", "Брестом", "Бресте",
    "Витебск", "Витебска", "Витебску", "Витебском", "Витебске",
    "Гомель", "Гомеля", "Гомелю", "Гомелем", "Гомеле",
    "Гродно", "Гродно", "Гродно", "Гродно", "Гродно",
    "Могилёв", "Могилёва", "Могилёву", "Могилёвом", "Могилёве",

    "Барановичи", "Барановичей", "Барановичам", "Барановичами", "Барановичах",
    "Берёза", "Берёзы", "Берёзе", "Берёзу", "Берёзой", "Берёзе",
    "Береза", "Березы", "Березе", "Березу", "Березой", "Березе",
    "Белоозёрск", "Белоозёрска", "Белоозёрску", "Белоозёрском", "Белоозёрске",
    "Белоозерск", "Белоозерска", "Белоозерску", "Белоозерском", "Белоозерске",
    "Брестский", "Брестского", "Брестскому", "Брестским", "Брестском",

    "Дрогичин", "Дрогичина", "Дрогичину", "Дрогичином", "Дрогичине",
    "Иваново", "Иваново", "Иваново", "Иваново", "Иваново",
    "Ивацевичи", "Ивацевичей", "Ивацевичам", "Ивацевичами", "Ивацевичах",
    "Каменец", "Каменца", "Каменцу", "Каменцем", "Каменце",
    "Кобрин", "Кобрина", "Кобрину", "Кобрином", "Кобрине",
    "Лунинец", "Лунинца", "Лунинцу", "Лунинцем", "Лунинце",
    "Ляховичи", "Ляховичей", "Ляховичам", "Ляховичами", "Ляховичах",
    "Малорита", "Малориты", "Малорите", "Малориту", "Малоритой", "Малорите",
    "Пинск", "Пинска", "Пинску", "Пинском", "Пинске",
    "Пружаны", "Пружан", "Пружанам", "Пружанами", "Пружанах",
    "Столин", "Столина", "Столину", "Столином", "Столине",

    "Бешенковичи", "Бешенковичей", "Бешенковичам", "Бешенковичами", "Бешенковичах",
    "Браслав", "Браслава", "Браславу", "Браславом", "Браславе",
    "Верхнедвинск", "Верхнедвинска", "Верхнедвинску", "Верхнедвинском", "Верхнедвинске",
    "Глубокое", "Глубокого", "Глубокому", "Глубоком", "Глубоком",
    "Городок", "Городка", "Городку", "Городком", "Городке",
    "Докшицы", "Докшиц", "Докшицам", "Докшицами", "Докшицах",
    "Дубровно", "Дубровно", "Дубровно", "Дубровно", "Дубровно",
    "Лепель", "Лепеля", "Лепелю", "Лепелем", "Лепеле",
    "Лиозно", "Лиозно", "Лиозно", "Лиозно", "Лиозно",
    "Миоры", "Миор", "Миорам", "Миорами", "Миорах",
    "Орша", "Орши", "Орше", "Оршу", "Оршой", "Орше",
    "Полоцк", "Полоцка", "Полоцку", "Полоцком", "Полоцке",
    "Поставы", "Постав", "Поставам", "Поставами", "Поставах",
    "Россоны", "Россон", "Россонам", "Россонами", "Россонах",
    "Сенно", "Сенно", "Сенно", "Сенно", "Сенно",
    "Толочин", "Толочина", "Толочину", "Толочином", "Толочине",
    "Ушачи", "Ушачей", "Ушачам", "Ушачами", "Ушачах",
    "Чашники", "Чашников", "Чашникам", "Чашниками", "Чашниках",
    "Шарковщина", "Шарковщины", "Шарковщине", "Шарковщину", "Шарковщиной", "Шарковщине",
    "Шумилино", "Шумилино", "Шумилино", "Шумилино", "Шумилино",

    "Брагин", "Брагина", "Брагину", "Брагином", "Брагине",
    "Буда-Кошелёво", "Буды-Кошелёво", "Буде-Кошелёво", "Буду-Кошелёво", "Будой-Кошелёво",
    "Буда-Кошелево", "Буды-Кошелево", "Буде-Кошелево", "Буду-Кошелево", "Будой-Кошелево",
    "Ветка", "Ветки", "Ветке", "Ветку", "Веткой", "Ветке",
    "Добруш", "Добруша", "Добрушу", "Добрушем", "Добруше",
    "Ельск", "Ельска", "Ельску", "Ельском", "Ельске",
    "Житковичи", "Житковичей", "Житковичам", "Житковичами", "Житковичах",
    "Жлобин", "Жлобина", "Жлобину", "Жлобином", "Жлобине",
    "Калинковичи", "Калинковичей", "Калинковичам", "Калинковичами", "Калинковичах",
    "Корма", "Кормы", "Корме", "Корму", "Кормой", "Корме",
    "Лельчицы", "Лельчиц", "Лельчицам", "Лельчицами", "Лельчицах",
    "Лоев", "Лоева", "Лоеву", "Лоевом", "Лоеве",
    "Мозырь", "Мозыря", "Мозырю", "Мозырем", "Мозыре",
    "Наровля", "Наровли", "Наровле", "Наровлю", "Наровлей", "Наровле",
    "Октябрьский", "Октябрьского", "Октябрьскому", "Октябрьским", "Октябрьском",
    "Петриков", "Петрикова", "Петрикову", "Петриковом", "Петрикове",
    "Речица", "Речицы", "Речице", "Речицу", "Речицей", "Речице",
    "Рогачёв", "Рогачёва", "Рогачёву", "Рогачёвом", "Рогачёве",
    "Рогачев", "Рогачева", "Рогачеву", "Рогачевом", "Рогачеве",
    "Светлогорск", "Светлогорска", "Светлогорску", "Светлогорском", "Светлогорске",
    "Хойники", "Хойников", "Хойникам", "Хойниками", "Хойниках",
    "Чечерск", "Чечерска", "Чечерску", "Чечерском", "Чечерске",

    "Берестовица", "Берестовицы", "Берестовице", "Берестовицу", "Берестовицей", "Берестовице",
    "Волковыск", "Волковыска", "Волковыску", "Волковыском", "Волковыске",
    "Вороново", "Вороново", "Вороново", "Вороново", "Вороново",
    "Дятлово", "Дятлово", "Дятлово", "Дятлово", "Дятлово",
    "Зельва", "Зельвы", "Зельве", "Зельву", "Зельвой", "Зельве",
    "Ивье", "Ивья", "Ивью", "Ивьем", "Ивье",
    "Кореличи", "Кореличей", "Кореличам", "Кореличами", "Кореличах",
    "Мосты", "Мостов", "Мостам", "Мостами", "Мостах",
    "Новогрудок", "Новогрудка", "Новогрудку", "Новогрудком", "Новогрудке",
    "Островец", "Островца", "Островцу", "Островцем", "Островце",
    "Ошмяны", "Ошмян", "Ошмянам", "Ошмянами", "Ошмянах",
    "Свислочь", "Свислочи", "Свислочи", "Свислочь", "Свислочью", "Свислочи",
    "Скидель", "Скиделя", "Скиделю", "Скиделем", "Скиделе",
    "Слоним", "Слонима", "Слониму", "Слонимом", "Слониме",
    "Сморгонь", "Сморгони", "Сморгони", "Сморгонь", "Сморгонью", "Сморгони",
    "Щучин", "Щучина", "Щучину", "Щучином", "Щучине",

    "Белыничи", "Белыничей", "Белыничам", "Белыничами", "Белыничах",
    "Бобруйск", "Бобруйска", "Бобруйску", "Бобруйском", "Бобруйске",
    "Быхов", "Быхова", "Быхову", "Быховом", "Быхове",
    "Глуск", "Глуска", "Глуску", "Глуском", "Глуске",
    "Горки", "Горок", "Горкам", "Горками", "Горках",
    "Дрибин", "Дрибина", "Дрибину", "Дрибином", "Дрибине",
    "Кировск", "Кировска", "Кировску", "Кировском", "Кировске",
    "Климовичи", "Климовичей", "Климовичам", "Климовичами", "Климовичах",
    "Кличев", "Кличева", "Кличеву", "Кличевом", "Кличеве",
    "Костюковичи", "Костюковичей", "Костюковичам", "Костюковичами", "Костюковичах",
    "Краснополье", "Краснополья", "Краснополью", "Краснопольем", "Краснополье",
    "Кричев", "Кричева", "Кричеву", "Кричевом", "Кричеве",
    "Круглое", "Круглого", "Круглому", "Круглом", "Круглом",
    "Могилёв", "Могилёва", "Могилёву", "Могилёвом", "Могилёве",
    "Могилев", "Могилева", "Могилеву", "Могилевом", "Могилеве",
    "Мстиславль", "Мстиславля", "Мстиславлю", "Мстиславлем", "Мстиславле",
    "Осиповичи", "Осиповичей", "Осиповичам", "Осиповичами", "Осиповичах",
    "Славгород", "Славгорода", "Славгороду", "Славгородом", "Славгороде",
    "Хотимск", "Хотимска", "Хотимску", "Хотимском", "Хотимске",
    "Чаусы", "Чаусов", "Чаусам", "Чаусами", "Чаусах",
    "Чериков", "Черикова", "Черикову", "Чериковом", "Черикове",
    "Шклов", "Шклова", "Шклову", "Шкловом", "Шклове"
}


class QuerySpellChecker:
    def __init__(self):
        """
        Инициализация spellchecker с кастомными словами.
        """
        self.spell = SpellChecker(language='ru')
        self.spell.word_frequency.load_words(CUSTOM_WORDS)
        self.custom_words: Set[str] = CUSTOM_WORDS

    def correct_query(self, query: str) -> str:
        """
        Исправляет опечатки в строке запроса, кроме custom_words.

        Args:
            query: пользовательский запрос

        Returns:
            исправленный запрос
        """
        tokens = query.split()
        corrected_tokens = []
        for token in tokens:
            if token in self.custom_words:
                corrected_tokens.append(token)
            else:
                corrected_tokens.append(self.spell.correction(token) or token)
        return " ".join(corrected_tokens)
